#!/usr/bin/env bash

export PATH="$PATH:$HOME/.composer/vendor/bin"

pm4dir="$(dirname "$(readlink -f "$0")")"
files=$(git status --porcelain=v2 | grep -E '^\d [AM].*\.php$' | cut -d ' ' -f 9)
errors=()
if [ -n "$files" ]; then
    while read file; do
        echo "Checking $file"
        php-cs-fixer fix --dry-run --verbose "$file" 2> /dev/null
        if [ $? -ne 0 ]; then
            errors+=("$file")
        fi
    done <<< "$files"
fi
